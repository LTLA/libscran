<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>scran: scran::CenterSizeFactors Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">scran
   </div>
   <div id="projectbrief">C++ library for basic single-cell RNA-seq analyses</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacescran.html">scran</a></li><li class="navelem"><a class="el" href="classscran_1_1CenterSizeFactors.html">CenterSizeFactors</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="classscran_1_1CenterSizeFactors-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">scran::CenterSizeFactors Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Center size factors prior to scaling normalization.  
 <a href="classscran_1_1CenterSizeFactors.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="CenterSizeFactors_8hpp_source.html">CenterSizeFactors.hpp</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="nested-classes" name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structscran_1_1CenterSizeFactors_1_1Defaults.html">Defaults</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Default parameter settings.  <a href="structscran_1_1CenterSizeFactors_1_1Defaults.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a511d8d0b9259cd5e3595edb8b8573189"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscran_1_1CenterSizeFactors.html#a511d8d0b9259cd5e3595edb8b8573189">BlockMode</a> { <b>PER_BLOCK</b>
, <b>LOWEST</b>
 }</td></tr>
<tr class="separator:a511d8d0b9259cd5e3595edb8b8573189"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ac8edc812cc10eb1439d21c7d78570650"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classscran_1_1CenterSizeFactors.html">CenterSizeFactors</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscran_1_1CenterSizeFactors.html#ac8edc812cc10eb1439d21c7d78570650">set_block_mode</a> (<a class="el" href="classscran_1_1CenterSizeFactors.html#a511d8d0b9259cd5e3595edb8b8573189">BlockMode</a> b=<a class="el" href="structscran_1_1CenterSizeFactors_1_1Defaults.html#a1b72abdcaa1fcd1bc846418e0480c2b6">Defaults::block_mode</a>)</td></tr>
<tr class="separator:ac8edc812cc10eb1439d21c7d78570650"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aef603859bb04b43b408c6a67418c69d9"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classscran_1_1CenterSizeFactors.html">CenterSizeFactors</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classscran_1_1CenterSizeFactors.html#aef603859bb04b43b408c6a67418c69d9">set_ignore_zeros</a> (bool i=<a class="el" href="structscran_1_1CenterSizeFactors_1_1Defaults.html#a818565bd477ef479ae6a557d54ed4a47">Defaults::ignore_zeros</a>)</td></tr>
<tr class="separator:aef603859bb04b43b408c6a67418c69d9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9214094c2b9004094e94f14bbc435767"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:a9214094c2b9004094e94f14bbc435767"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classscran_1_1CenterSizeFactors.html#a9214094c2b9004094e94f14bbc435767">run</a> (size_t n, T *size_factors) const</td></tr>
<tr class="separator:a9214094c2b9004094e94f14bbc435767"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3fa9e4cc11073a04fdcdc7443e883234"><td class="memTemplParams" colspan="2">template&lt;typename T , typename B &gt; </td></tr>
<tr class="memitem:a3fa9e4cc11073a04fdcdc7443e883234"><td class="memTemplItemLeft" align="right" valign="top">bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classscran_1_1CenterSizeFactors.html#a3fa9e4cc11073a04fdcdc7443e883234">run_blocked</a> (size_t n, T *size_factors, const B *block) const</td></tr>
<tr class="separator:a3fa9e4cc11073a04fdcdc7443e883234"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-static-methods" name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:ad604e87b1eb2c0e23601e6c0ee6014a4"><td class="memTemplParams" colspan="2">template&lt;typename T &gt; </td></tr>
<tr class="memitem:ad604e87b1eb2c0e23601e6c0ee6014a4"><td class="memTemplItemLeft" align="right" valign="top">static bool&#160;</td><td class="memTemplItemRight" valign="bottom"><a class="el" href="classscran_1_1CenterSizeFactors.html#ad604e87b1eb2c0e23601e6c0ee6014a4">validate</a> (size_t n, const T *size_factors)</td></tr>
<tr class="separator:ad604e87b1eb2c0e23601e6c0ee6014a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p >Center size factors prior to scaling normalization. </p>
<p >The aim of centering is to ensure that the normalized expression values are on roughly the same scale as the original counts. This simplifies interpretation and ensures that any added pseudo-count prior to log-transformation has a predictable shrinkage effect. The functionality in this class is used automatically by <code><a class="el" href="classscran_1_1LogNormCounts.html" title="Compute log-normalized expression values.">LogNormCounts</a></code> but can be called separately if desired. </p>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="a511d8d0b9259cd5e3595edb8b8573189" name="a511d8d0b9259cd5e3595edb8b8573189"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a511d8d0b9259cd5e3595edb8b8573189">&#9670;&#160;</a></span>BlockMode</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="classscran_1_1CenterSizeFactors.html#a511d8d0b9259cd5e3595edb8b8573189">scran::CenterSizeFactors::BlockMode</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Strategy for handling blocks, see <code><a class="el" href="classscran_1_1CenterSizeFactors.html#ac8edc812cc10eb1439d21c7d78570650">set_block_mode()</a></code> for details. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a9214094c2b9004094e94f14bbc435767" name="a9214094c2b9004094e94f14bbc435767"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9214094c2b9004094e94f14bbc435767">&#9670;&#160;</a></span>run()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool scran::CenterSizeFactors::run </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>size_factors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>Floating-point type for the size factors.</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">n</td><td>Number of size factors. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">size_factors</td><td>Pointer to an array of positive size factors of length <code>n</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Entries in <code>size_factors</code> are scaled so that their mean is equal to 1. A boolean is returned indicating whether size factors of zero were detected. </dd></dl>

</div>
</div>
<a id="a3fa9e4cc11073a04fdcdc7443e883234" name="a3fa9e4cc11073a04fdcdc7443e883234"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3fa9e4cc11073a04fdcdc7443e883234">&#9670;&#160;</a></span>run_blocked()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T , typename B &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool scran::CenterSizeFactors::run_blocked </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">T *&#160;</td>
          <td class="paramname"><em>size_factors</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const B *&#160;</td>
          <td class="paramname"><em>block</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>Floating-point type for the size factors. </td></tr>
    <tr><td class="paramname">B</td><td>An integer type, to hold the block IDs.</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">n</td><td>Number of size factors. </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">size_factors</td><td>Pointer to an array of positive size factors of length 1n1. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">block</td><td>Pointer to an array of block identifiers. If provided, the array should be of length equal to <code>n</code>. Values should be integer IDs in <picture><source srcset="form_0_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$[0, N)$" src="form_0.png"/></picture> where <picture><source srcset="form_1_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$N$" src="form_1.png"/></picture> is the number of blocks. This can also be a <code>NULL</code>, in which case all cells are assumed to belong to the same block.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Entries in <code>size_factors</code> are scaled according to the mode defined by <code><a class="el" href="classscran_1_1CenterSizeFactors.html#ac8edc812cc10eb1439d21c7d78570650">set_block_mode()</a></code>. A boolean is returned indicating whether size factors of zero were detected. </dd></dl>

</div>
</div>
<a id="ac8edc812cc10eb1439d21c7d78570650" name="ac8edc812cc10eb1439d21c7d78570650"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac8edc812cc10eb1439d21c7d78570650">&#9670;&#160;</a></span>set_block_mode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classscran_1_1CenterSizeFactors.html">CenterSizeFactors</a> &amp; scran::CenterSizeFactors::set_block_mode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classscran_1_1CenterSizeFactors.html#a511d8d0b9259cd5e3595edb8b8573189">BlockMode</a>&#160;</td>
          <td class="paramname"><em>b</em> = <code><a class="el" href="structscran_1_1CenterSizeFactors_1_1Defaults.html#a1b72abdcaa1fcd1bc846418e0480c2b6">Defaults::block_mode</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">b</td><td>Strategy for handling blocks in <code><a class="el" href="classscran_1_1CenterSizeFactors.html#a3fa9e4cc11073a04fdcdc7443e883234">run_blocked()</a></code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A reference to this <code><a class="el" href="classscran_1_1CenterSizeFactors.html" title="Center size factors prior to scaling normalization.">CenterSizeFactors</a></code> object.</dd></dl>
<p>With the <code>PER_BLOCK</code> strategy, size factors are scaled separately for each block so that they have a mean of 1 within each block. The scaled size factors are identical to those obtained by separate invocations of <code><a class="el" href="classscran_1_1CenterSizeFactors.html#a9214094c2b9004094e94f14bbc435767">CenterSizeFactors::run()</a></code> on the size factors for each block. This can be desirable to ensure consistency with independent analyses of each block - otherwise, the centering would depend on the size factors across all blocks.</p>
<p >With the <code>LOWEST</code> strategy, we compute the mean size factor for each block and we divide all size factors by the minimum mean. In effect, we downscale all blocks to match the coverage of the lowest-coverage block. This is useful for datasets with highly heterogeneous coverage of different blocks as it avoids egregious upscaling of low-coverage blocks. (By contrast, downscaling is always safe as it simply discards information across all blocks by shrinking log-fold changes towards zero at low expression.) </p>

</div>
</div>
<a id="aef603859bb04b43b408c6a67418c69d9" name="aef603859bb04b43b408c6a67418c69d9"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aef603859bb04b43b408c6a67418c69d9">&#9670;&#160;</a></span>set_ignore_zeros()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classscran_1_1CenterSizeFactors.html">CenterSizeFactors</a> &amp; scran::CenterSizeFactors::set_ignore_zeros </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>i</em> = <code><a class="el" href="structscran_1_1CenterSizeFactors_1_1Defaults.html#a818565bd477ef479ae6a557d54ed4a47">Defaults::ignore_zeros</a></code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">i</td><td>Whether to ignore zeros when computing the mean size factor.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A reference to this <code><a class="el" href="classscran_1_1CenterSizeFactors.html" title="Center size factors prior to scaling normalization.">CenterSizeFactors</a></code> object.</dd></dl>
<p>While size factors of zero are generally invalid, they may occur in datasets that have not been properly filtered to remove low-quality cells. In such cases, we may wish to ignore size factors of zero so as to avoid a spurious deflation of the mean during centering. This is useful if some filtering is to be applied after normalization - by ignoring zeros now, we ensure that we get the same result as if we had removed those zeros prior to centering. </p>

</div>
</div>
<a id="ad604e87b1eb2c0e23601e6c0ee6014a4" name="ad604e87b1eb2c0e23601e6c0ee6014a4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad604e87b1eb2c0e23601e6c0ee6014a4">&#9670;&#160;</a></span>validate()</h2>

<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;typename T &gt; </div>
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static bool scran::CenterSizeFactors::validate </td>
          <td>(</td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>n</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const T *&#160;</td>
          <td class="paramname"><em>size_factors</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p >Validate size factors by checking that they are all non-zero. We also check whether any size factors are zero, which may be handled separately by callers.</p>
<dl class="tparams"><dt>Template Parameters</dt><dd>
  <table class="tparams">
    <tr><td class="paramname">T</td><td>Floating-point type for the size factors.</td></tr>
  </table>
  </dd>
</dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir"></td><td class="paramname">n</td><td>Number of size factors. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">size_factors</td><td>Pointer to an array of non-negative size factors of length <code>n</code>.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Whether a size factor of zero was detected. An error is raised if a negative size factor is detected. </dd></dl>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>scran/normalization/<a class="el" href="CenterSizeFactors_8hpp_source.html">CenterSizeFactors.hpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
